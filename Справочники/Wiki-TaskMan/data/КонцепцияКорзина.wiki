++ Концепция Корзина
[template: ШаблонСтраницыРазделаКонцепции]
Состояние: [В РАЗРАБОТКЕ]

+++Ссылки раздела
* ГлоссарийОператор


+++Содержание раздела




+++Материалы
- одиночный клик по иконке Корзина в дереве элементов - показать содержимое Корзины.
- двойной клик по иконке Корзина в дереве элементов - показать карточку свойств Корзины?
- одиночный клик по элементу в корзине - ничего не показывать.
- двойной клик по элементу в корзине - показать Карточку Элемента.

++++Заготовки для Корзина:
- Корзина это нода в корне дерева, создаваемая полностью кодом.
  - Создается в БД как нода, защищенная от удаления.
  - Иконка корзины должна быть добавлена в коллекцию иконок дерева.
  - Иконки элементов корзины используются обычные.
  - ноды элементов Корзины хранят объекты элементов обычно для дерва, в поле Tag.
- событие раскрытия Корзины перехватить в обработчике NodeExpanding() и вызывать функцию FillTrashCan().
- событие  NodeCollapsing() такое же, как везде, вставляет временную ноду.
- выборка всех объектов, помеченных в БД как удаленные
- выборка получения имени по ид элемента: SELECT title FROM Elements WHERE (id = ?);
- построение цепочки ид для каждого элемента
  - цепочка ид во время сеанса может измениться, когда пользователь переподчинит элементы.
    Поэтому цепочку не хранить постоянно, а вычислять на момент применения.
    И производные от нее данные - тоже.
- флаг, что предыдущие элементы в цепочке не были удалены.
  - он нужен в операции восстановления удаленного элемента, это происходит редко.
- кеш имен элементов по ид, размером 128 - 256 элементов.
 - он должен ускорить построение пути удаленного элемента, сократив количество обращений к БД.
 - применять только внутри групповых операций, не сохранять между ними.
- по цепочке ид получать путь к элементу, как цепочку имен элементов, разделенных / 
  - вопрос: где показать этот путь для выбранного в дереве удаленного элемента?
- добавить элементы в ноду Корзины с правильной иконкой, цветом, итп.
  - эту функцию взять из базового класса.
- Сортировать субноды корзины по убыванию даты последнего изменения элемента 
  - то есть, по дате удаления в корзину.
- каждой ноде элемента прицепить контекстное меню удаленного элемента.
- если у удаленного элемента parent = тоже удаленный элемент, можно их связывать в ноды прямо внутри Корзины.
  - тогда сворачивание-разворачивание нод не будет работать.
  - это можно сделать в отдельном диалоге-дереве просмотра Корзины. Но пока незачем это делать.
  - решение: идею отложить на потом.
- перед восстановлением элемента надо проверить, что элементы в цепочке до текущего элемента - все активные.
  Если это не так, показать пользователю окно предупреждения.

++++ Процессы Корзина
+++++Удаление элемента
- выбрать элемент в дереве и открыть его карточку элемента.
-  в карточке элемента надо снять галочку Активен.
   - Если у элемента есть активные субэлементы, его нельзя пометить удаленным.
     - Но это надо показать пользователю явным текстовым сообщением, связанным именно с этим действием.
     - Карточка Элемента должна установить галочку Активен обратно.
   - Если у элемента нет субэлементов или нет активных субэлементов, 
     - Элемент сменит статус на Удален, Карточка Элемента снимет галочку Активен. 
- после закрытия КарточкаЭлемента дерево надо обновить, чтобы отразить изменения в структуре элементов.
  - Элемент должен исчезнуть из прежнего места и появиться в Корзина.

+++++Восстановление элемента
- выбрать элемент в разделе Корзина дерева элементов. Больше он нигде не должен отображаться.
- открыть карточку элемента
- в карточке элемента надо установить галочку Активен.
  - если в пути от корня дерева до восстанавливаемого элемента есть удаленные элементы, его нельзя восстановить.
    - но это надо показать пользователю явным текстовым сообщением, связанным именно с этим действием.
    - карточка элемента должна сбросить галочку Активен обратно.
  - если в пути от корня до восстанавливаемого элемента нет удаленных элементов,
    - Элемент сменит статус на Нормальный, Карточка Элемента установит галочку Активен. 
- после закрытия КарточкаЭлемента дерево надо обновить, чтобы отразить изменения в структуре элементов.
  - Элемент должен исчезнуть из Корзина и появиться в своем оригинальном месте.

+++++Пометка Защищен от удаления
- эта пометка пока что не может быть установлена пользователем.
- но если разрешить, то:
  - надо все элементы ДО этого элемента (вверх по дереву) тоже пометить защищенными от удаления.
  - или нет, так как удаление ноды требует отсутствия у нее субнод.
  - так что проще пока не давать пользователю помечать ноды защищенным иот удаления.

+++++Просмотр корзины
- надо как-топросматривать элементы Корзины с показом их прежних путей.
 В формате: Иконка;Название;Исходное расположение;Дата удаления;Тип элемента; Описание элемента;
Предлагается такая таблица вроде ListView на вкладке в правой панели главного окна.
Она будет вызываться при активации ноды  Корзина в дереве элементов.
и кликом по элементу в ListView можно открыть КарточкаЭлемента.
Можно также сортировать элементы в этом списке по столбцу Название или Тип элемента или Дата удаления или Исходное расположение.
- это лучше отложить на потом.


++++Команды Корзина:
  - Очистить корзину
  - восстановить выделенные объекты
  - восстановить все объекты
  - свойства корзины
    - режим удалять старые после достижения максимального числа элементов.
    - режим удалять без помещения в корзину
    - запрашивать подтверждение перед помещением элемента в корзину.



